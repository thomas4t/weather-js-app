variables:
  FRONTEND_BASE_COMPONENT: "frontend_base"
  FRONTEND_BASE_VERSION: "16.13.0" # If you change dependencies, bump the version here
  FRONTEND_STORYBOOK_BASE_COMPONENT: "frontend_storybook_base"
  FRONTEND_STORYBOOK_BASE_VERSION: "1" # If you change dependencies, bump the version here
  # This variable is also set by the kaniko image based on provided COMPONENT and VERSION
  # If these match, and an image is built in the pipeline, the sha digest is used instead in scripts
  # this has no effect on gitlab job definitions (image:xyz) though as these are resolved before any scripts are run
  FRONTEND_BASE_IMAGE: "$CI_REGISTRY_IMAGE/$FRONTEND_BASE_COMPONENT:$FRONTEND_BASE_VERSION"
  FRONTEND_STORYBOOK_BASE_IMAGE: "$CI_REGISTRY_IMAGE/$FRONTEND_STORYBOOK_BASE_COMPONENT:$FRONTEND_STORYBOOK_BASE_VERSION"

frontend-base-image:
  extends: .kaniko-build-template
  stage: .pre
  except:
    - tags
  variables:
    COMPONENT: $FRONTEND_BASE_COMPONENT
    CONTEXT: "frontend"
    DOCKERFILE: "frontend/Dockerfile"
  before_script:
    - export BUILD_ARGS="--target base"
  only:
    changes:
      - frontend/.gitlab-ci.base.yml
      - frontend/Dockerfile
      - frontend/package.json
      - frontend/yarn.lock

frontend-storybook-base-image:
  extends: .kaniko-build-template
  stage: .pre
  except:
    - tags
  variables:
    COMPONENT: $FRONTEND_STORYBOOK_BASE_COMPONENT
    CONTEXT: "frontend"
    DOCKERFILE: "frontend/Dockerfile-storybook"
  before_script:
    - export BUILD_ARGS="--target base"
  only:
    changes:
      - frontend/.gitlab-ci.base.yml
      - frontend/Dockerfile-storybook
      - frontend/package.json
      - frontend/yarn.lock
